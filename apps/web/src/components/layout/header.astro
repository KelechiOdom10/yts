---
import { Button } from "../ui";
import AuthMenu from "./auth-menu.astro";
import { IconAlignmentCenter } from "justd-icons";

// Get the current path to highlight active navigation items
const currentPath = Astro.url.pathname;

// Navigation items for the header
const navItems = [
  { name: "Features", href: "/#features" },
  { name: "Pricing", href: "/pricing" },
  { name: "Explore", href: "/explore" },
  { name: "Contact", href: "mailto:contact@yts.ai" },
];
---

<header
  class="fixed top-4 left-0 right-0 max-w-7xl mx-4 xl:mx-auto z-50 rounded-sm md:rounded-full shadow-md bg-white/80 pr-3 py-2.5 pl-5 border backdrop-blur-2xl"
>
  <div class="flex justify-between">
    <div class="flex">
      <div class="flex-shrink-0 flex items-center">
        <a
          href="/"
          class="flex items-center gap-2 font-semibold text-lg font-header"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="h-6 w-6 text-red-600"
          >
            <path
              d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"
            ></path>
          </svg>
          <span>VideoInsight</span>
        </a>
      </div>
      <nav class="hidden md:ml-8 md:flex md:space-x-6">
        {
          navItems.map(item => (
            <a
              href={item.href}
              class={`inline-flex items-center px-1 pt-1 text-sm font-medium border-b-2 transition-colors ${
                currentPath === item.href
                  ? "border-primary text-fg"
                  : "border-transparent text-fg hover:border-primary hover:text-fg/90"
              }`}
            >
              {item.name}
            </a>
          ))
        }
      </nav>
    </div>

    <!-- User menu and mobile menu button -->
    <div class="flex items-center gap-2">
      <AuthMenu server:defer />
      <!-- Mobile menu button -->
      <div class="flex items-center md:hidden">
        <Button
          aria-label="Open main menu"
          className="mobile-menu-button"
          aria-expanded="false"
          size="square-petite"
          shape="square"
          variant="outline"
        >
          <IconAlignmentCenter />
        </Button>
      </div>
    </div>
  </div>

  <!-- Mobile menu, show/hide based on menu state -->
  <div class="hidden mobile-menu md:hidden">
    <div class="pt-2 pb-3 space-y-1">
      {
        navItems.map(item => (
          <a
            href={item.href}
            class={`block pl-3 pr-4 py-2 border-l-4 text-base font-medium ${
              currentPath === item.href
                ? "bg-primary-50 border-primary-500 text-primary-700"
                : "border-transparent text-fg hover:bg-primary/10 hover:border-primary"
            }`}
          >
            {item.name}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  document.addEventListener("DOMContentLoaded", () => {
    const button = document.querySelector(".mobile-menu-button");
    const menu = document.querySelector(".mobile-menu");

    if (button && menu) {
      button.addEventListener("click", () => {
        menu.classList.toggle("hidden");

        // Update aria-expanded
        const expanded = button.getAttribute("aria-expanded") === "true";
        button.setAttribute("aria-expanded", (!expanded).toString());
      });

      // Close the mobile menu when clicking outside
      document.addEventListener("click", event => {
        if (
          button &&
          !button.contains(event.target as Node) &&
          menu &&
          !menu.contains(event.target as Node)
        ) {
          button.setAttribute("aria-expanded", "false");
          menu.classList.add("hidden");
        }
      });
    }
  });
</script>

<!-- Spacer to prevent content from being hidden under the fixed header -->
<div class="h-16"></div>
